(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{2824:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>S});var l=a(5155),n=a(6695),r=a(172),t=a(8294),i=a(157);let c=(0,i.A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var o=a(9591),d=a(7223),u=a(4301);let m=(0,i.A)("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);var x=a(285),h=a(5937),p=a(9409),j=a(2523),v=a(2177),f=a(221),w=a(5594),g=a(2115),y=a(5317),b=a(6104),N=a(3004),z=a(7481),C=a(5695),A=a(7262),k=a(1949);let L=w.z.object({location:w.z.string().min(1,"الرجاء اختيار الموقع."),amount:w.z.coerce.number().min(0,"المبلغ يجب أن يكون رقما موجبا.").max(3e6,"المبلغ يجب أن لا يتجاوز 3,000,000 أوقية")}),P=w.z.object({currentLocation:w.z.string({required_error:"الموقع الحالي مطلوب."}),teacherFunction:w.z.string(),specialization:w.z.union([w.z.string(),w.z.array(w.z.string())]),desiredLocation:w.z.array(w.z.string()).refine(e=>e.some(e=>e),{message:"يجب أن تختار خيارًا واحدًا على الأقل."}),phone:w.z.string().length(8,"يجب أن يتكون رقم الهاتف من 8 أرقام.").regex(/^[234]/,"يجب أن يبدأ رقم الهاتف بـ 2, 3, أو 4."),offersCompensation:w.z.boolean().default(!1),compensationDetails:w.z.array(L).optional(),newPassword:w.z.string().optional(),currentPassword:w.z.string().optional()}).refine(e=>!e.newPassword||!!e.currentPassword,{message:"كلمة المرور الحالية مطلوبة لتغييرها.",path:["currentPassword"]});function S(){var e,s;let[i,w]=(0,g.useState)(null),[L,S]=(0,g.useState)(!0),[I,R]=(0,g.useState)(!1),[_,M]=(0,g.useState)(null),{toast:D}=(0,z.dj)(),B=(0,C.useRouter)(),E=(0,v.mN)({resolver:(0,f.u)(P),defaultValues:{currentLocation:"",teacherFunction:"",specialization:[],desiredLocation:[],phone:"",offersCompensation:!1,compensationDetails:[],newPassword:"",currentPassword:""}}),{fields:V,append:J,remove:F,replace:O}=(0,v.jz)({control:E.control,name:"compensationDetails"}),Z=E.watch("offersCompensation"),q=E.watch("desiredLocation"),W=E.watch("compensationDetails");(0,g.useEffect)(()=>{!async function(){try{let e=await a.e(950).then(a.bind(a,1950));M({wilayas:e.WILAYAS,allSpecializations:e.ALL_SPECIALIZATIONS})}catch(e){console.error("Failed to load constants",e)}}()},[]),(0,g.useEffect)(()=>{let e=(0,N.hg)(b.j,async e=>{e?w(e):B.push("/login")});return()=>e()},[B]),(0,g.useEffect)(()=>{i&&_&&(async()=>{S(!0);let e=(0,y.H9)(b.db,"users",i.uid),s=await (0,y.x7)(e);if(s.exists()){let e=s.data(),a=e.compensationDetails?Object.entries(e.compensationDetails).map(e=>{let[s,a]=e;return{location:s,amount:a}}):[];E.reset({currentLocation:e.currentLocation,teacherFunction:e.teacherFunction,specialization:e.specialization,desiredLocation:e.desiredLocation||[],phone:e.phone||"",offersCompensation:e.offersCompensation||!1,compensationDetails:a}),O(a)}S(!1)})()},[i,_,E,O]);let $=()=>{if(!_)return[];let e=q.map(e=>{if(e.startsWith("wilaya_")){let s=e.replace("wilaya_","");return{value:e,label:"".concat(s," (ولاية)")}}let s=_.wilayas.flatMap(e=>e.cities).find(s=>s.value===e);return{value:e,label:(null==s?void 0:s.label)||e}}),s=new Set(null==W?void 0:W.map(e=>e.location));return e.filter(e=>!s.has(e.value))};async function H(e){var s;if(!i)return void D({variant:"destructive",title:"خطأ",description:"يجب أن تكون مسجلاً للدخول."});R(!0);let a=(null==(s=e.compensationDetails)?void 0:s.reduce((e,s)=>(s.location&&s.amount>=0&&(e[s.location]=s.amount),e),{}))||{};try{if(e.newPassword&&e.currentPassword){if(!i.email){D({variant:"destructive",title:"خطأ",description:"البريد الإلكتروني للمستخدم غير موجود."}),R(!1);return}let s=N.IX.credential(i.email,e.currentPassword);await (0,N.kZ)(i,s),await (0,N.f3)(i,e.newPassword),D({title:"تم تحديث كلمة المرور بنجاح"}),E.reset({...e,newPassword:"",currentPassword:""})}let s=(0,y.H9)(b.db,"users",i.uid);await (0,y.mZ)(s,{desiredLocation:e.desiredLocation,phone:e.phone,offersCompensation:e.offersCompensation,compensationDetails:a,lastUpdated:y.Dc.now()}),D({title:"تم الحفظ بنجاح",description:"تم تحديث معلومات ملفك الشخصي."})}catch(s){console.error("Error updating profile:",s);let e="لم نتمكن من حفظ تغييراتك. حاول مرة أخرى.";"auth/wrong-password"===s.code?e="كلمة المرور الحالية غير صحيحة.":"auth/weak-password"===s.code&&(e="كلمة المرور الجديدة ضعيفة جدًا."),D({variant:"destructive",title:"خطأ في الحفظ",description:e})}finally{R(!1)}}return L||!_?(0,l.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,l.jsx)(r.A,{className:"h-8 w-8 animate-spin"})}):(0,l.jsx)("div",{className:"flex justify-center pb-16 md:pb-20",children:(0,l.jsxs)(n.Zp,{className:"w-full max-w-2xl",children:[(0,l.jsxs)(n.aR,{children:[(0,l.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(t.A,{}),(0,l.jsx)("span",{children:"الملف الشخصي"})]}),(0,l.jsx)(n.BT,{children:"هنا يمكنك عرض وتعديل معلومات ملفك الشخصي وتفضيلات التبادل."})]}),(0,l.jsx)(h.lV,{...E,children:(0,l.jsxs)("form",{onSubmit:E.handleSubmit(H),children:[(0,l.jsxs)(n.Wu,{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-4 rounded-lg border bg-muted/50 p-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:"معلومات أساسية"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"لا يمكن تعديل هذه المعلومات. لتغييرها, يرجى الاتصال بالإدارة."}),(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsxs)(h.eI,{children:[(0,l.jsx)(h.lR,{children:"الموقع الحالي"}),(0,l.jsx)(j.p,{value:(null==(e=_.wilayas.flatMap(e=>e.cities).find(e=>e.value===E.getValues("currentLocation")))?void 0:e.label)||"",disabled:!0})]}),(0,l.jsxs)(h.eI,{children:[(0,l.jsx)(h.lR,{children:"التخصص"}),(0,l.jsx)(j.p,{value:(s=E.getValues("specialization"),_?(Array.isArray(s)?s:[s]).map(e=>{var s;return(null==(s=_.allSpecializations.find(s=>s.value===e))?void 0:s.label)||e}).join("، "):Array.isArray(s)?s.join(", "):s),disabled:!0})]})]})]}),(0,l.jsx)(h.zB,{control:E.control,name:"phone",render:e=>{let{field:s}=e;return(0,l.jsxs)(h.eI,{children:[(0,l.jsxs)(h.lR,{className:"flex items-center gap-2",children:[(0,l.jsx)(c,{})," رقم الهاتف"]}),(0,l.jsx)(h.MJ,{children:(0,l.jsx)(j.p,{placeholder:"أدخل رقم هاتفك",...s})}),(0,l.jsx)(h.C5,{})]})}}),(0,l.jsx)(h.zB,{control:E.control,name:"desiredLocation",render:()=>(0,l.jsxs)(h.eI,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)(h.lR,{className:"text-base",children:"الأماكن المرغوبة"}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"اختر المدن أو الولايات التي ترغب في الانتقال إليها."})]}),(0,l.jsx)("div",{className:"space-y-4",children:_.wilayas.map(e=>(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(h.zB,{control:E.control,name:"desiredLocation",render:s=>{var a;let{field:n}=s,r=e.cities.every(e=>{var s;return null==(s=n.value)?void 0:s.includes(e.value)}),t="wilaya_".concat(e.name),i=(null==(a=n.value)?void 0:a.includes(t))||r;return(0,l.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse rounded-md border p-2 bg-muted/50",children:[(0,l.jsx)(A.S,{id:t,checked:i,onCheckedChange:s=>{let a=e.cities.map(e=>e.value),l=n.value?[...n.value]:[];if(s)l=[...new Set([...l,...a,t])];else{let e=new Set(a);l=l.filter(s=>!e.has(s)&&s!==t)}n.onChange(l)}}),(0,l.jsxs)("label",{htmlFor:t,className:"font-semibold text-sm",children:[e.name," (تحديد الكل)"]})]})}}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 pr-4",children:e.cities.map(s=>(0,l.jsx)(h.zB,{control:E.control,name:"desiredLocation",render:a=>{var n;let{field:r}=a;return(0,l.jsxs)(h.eI,{className:"flex flex-row items-start space-x-3 space-x-reverse space-y-0",children:[(0,l.jsx)(h.MJ,{children:(0,l.jsx)(A.S,{checked:null==(n=r.value)?void 0:n.includes(s.value),onCheckedChange:a=>{let l=a?[...r.value||[],s.value]:(r.value||[]).filter(e=>e!==s.value),n=e.cities.every(e=>l.includes(e.value)),t="wilaya_".concat(e.name);n&&!l.includes(t)?l.push(t):!n&&l.includes(t)&&l.splice(l.indexOf(t),1),r.onChange(l)}})}),(0,l.jsx)(h.lR,{className:"font-normal",children:s.label})]},s.value)}},s.value))})]},e.name))}),(0,l.jsx)(h.C5,{})]})}),(0,l.jsx)(h.zB,{control:E.control,name:"offersCompensation",render:e=>{let{field:s}=e;return(0,l.jsxs)(h.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,l.jsxs)("div",{className:"space-y-0.5",children:[(0,l.jsxs)(h.lR,{className:"text-base flex items-center gap-2",children:[(0,l.jsx)(o.A,{}),"عرض مقابل مادي"]}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"هل أنت على استعداد لتقديم تعويض مالي للتبديل؟"})]}),(0,l.jsx)(h.MJ,{children:(0,l.jsx)(k.d,{checked:s.value,onCheckedChange:s.onChange})})]})}}),Z&&(0,l.jsxs)("div",{className:"space-y-4 rounded-lg border p-4",children:[(0,l.jsx)(h.lR,{className:"text-base",children:"تحديد مبالغ المقابل المادي"}),(0,l.jsx)(h.Rr,{children:"أضف مبلغًا لكل مدينة أو ولاية ترغب في تقديم مقابل لها. يمكنك ترك الحقل فارغًا لعدم تحديد مقابل لمكان معين."}),(0,l.jsx)("div",{className:"space-y-2",children:V.map((e,s)=>(0,l.jsxs)("div",{className:"grid grid-cols-[1fr_auto_auto] items-end gap-2 p-2 border rounded-md",children:[(0,l.jsx)(h.zB,{control:E.control,name:"compensationDetails.".concat(s,".location"),render:e=>{var s;let{field:a}=e;return(0,l.jsxs)(h.eI,{children:[(0,l.jsx)(h.lR,{children:"الموقع"}),(0,l.jsxs)(p.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,l.jsx)(h.MJ,{children:(0,l.jsx)(p.bq,{children:(0,l.jsx)(p.yv,{placeholder:"اختر موقعًا..."})})}),(0,l.jsxs)(p.gC,{children:[a.value&&(0,l.jsx)(p.eb,{value:a.value,children:(null==(s=_.wilayas.flatMap(e=>e.cities).find(e=>e.value===a.value))?void 0:s.label)||a.value.replace("wilaya_","")}),$().map(e=>(0,l.jsx)(p.eb,{value:e.value,children:e.label},e.value))]})]}),(0,l.jsx)(h.C5,{})]})}}),(0,l.jsx)(h.zB,{control:E.control,name:"compensationDetails.".concat(s,".amount"),render:e=>{let{field:s}=e;return(0,l.jsxs)(h.eI,{children:[(0,l.jsx)(h.lR,{children:"المبلغ"}),(0,l.jsx)(h.MJ,{children:(0,l.jsx)(j.p,{type:"number",placeholder:"0",...s})}),(0,l.jsx)(h.C5,{})]})}}),(0,l.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>F(s),children:(0,l.jsx)(d.A,{className:"h-4 w-4 text-destructive"})})]},e.id))}),(0,l.jsxs)(x.$,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>J({location:"",amount:0}),disabled:0===$().length,children:[(0,l.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"إضافة مقابل لموقع آخر"]}),0===$().length&&(0,l.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"لقد قمت بتحديد مقابل لكل المواقع المرغوبة."})]}),(0,l.jsxs)("div",{className:"space-y-4 rounded-lg border p-4",children:[(0,l.jsxs)("h3",{className:"text-lg font-medium flex items-center gap-2",children:[(0,l.jsx)(m,{})," تغيير كلمة المرور"]}),(0,l.jsx)(h.zB,{control:E.control,name:"currentPassword",render:e=>{let{field:s}=e;return(0,l.jsxs)(h.eI,{children:[(0,l.jsx)(h.lR,{children:"كلمة المرور الحالية"}),(0,l.jsx)(h.MJ,{children:(0,l.jsx)(j.p,{type:"password",placeholder:"********",...s})}),(0,l.jsx)(h.C5,{})]})}}),(0,l.jsx)(h.zB,{control:E.control,name:"newPassword",render:e=>{let{field:s}=e;return(0,l.jsxs)(h.eI,{children:[(0,l.jsx)(h.lR,{children:"كلمة المرور الجديدة"}),(0,l.jsx)(h.MJ,{children:(0,l.jsx)(j.p,{type:"password",placeholder:"********",...s})}),(0,l.jsx)("p",{className:"text-sm text-muted-foreground",children:"اتركه فارغًا إذا لم ترغب في تغييره."}),(0,l.jsx)(h.C5,{})]})}})]})]}),(0,l.jsx)(n.wL,{children:(0,l.jsxs)(x.$,{type:"submit",disabled:I,children:[I&&(0,l.jsx)(r.A,{className:"ml-2 h-4 w-4 animate-spin"}),"حفظ التغييرات"]})})]})})]})})}},7885:(e,s,a)=>{Promise.resolve().then(a.bind(a,2824))},8294:(e,s,a)=>{"use strict";a.d(s,{A:()=>l});let l=(0,a(157).A)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]])}},e=>{var s=s=>e(e.s=s);e.O(0,[992,644,769,611,417,670,788,521,441,684,358],()=>s(7885)),_N_E=e.O()}]);