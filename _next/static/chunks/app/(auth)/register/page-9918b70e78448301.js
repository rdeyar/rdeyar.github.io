(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[678],{3075:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>B});var n=a(5155),l=a(6874),r=a.n(l),t=a(6695),i=a(221),c=a(2177),o=a(5594),d=a(2115),u=a(172),x=a(9591),h=a(7223),m=a(4301),j=a(5695),p=a(3004),v=a(5317),f=a(6104),g=a(285),y=a(5937),b=a(2523),C=a(9409),N=a(7481),z=a(7262),w=a(1949);let R=o.z.object({location:o.z.string().min(1,"الرجاء اختيار الموقع."),amount:o.z.coerce.number().min(0,"المبلغ يجب أن يكون رقما موجبا.").max(3e6,"المبلغ يجب أن لا يتجاوز 3,000,000 أوقية")}),S=o.z.object({username:o.z.string().min(1,"اسم المستخدم مطلوب"),phone:o.z.string().length(8,"يجب أن يتكون رقم الهاتف من 8 أرقام.").regex(/^[234]/,"يجب أن يبدأ رقم الهاتف بـ 2, 3, أو 4."),password:o.z.string().min(8,"يجب أن لا تقل كلمة المرور عن 8 أحرف."),teacherFunction:o.z.string({required_error:"الرجاء اختيار الوظيفة."}),specialization:o.z.union([o.z.string().min(1,"التخصص مطلوب."),o.z.array(o.z.string()).min(1,"يجب اختيار تخصص واحد على الأقل.").max(2,"لا يمكن اختيار أكثر من تخصصين.")]).refine(e=>Array.isArray(e)&&e.length>0||"string"==typeof e,{message:"التخصص مطلوب."}),currentLocation:o.z.string({required_error:"الرجاء اختيار الموقع الحالي."}),desiredLocation:o.z.array(o.z.string()).refine(e=>e.some(e=>e),{message:"يجب أن تختار خيارًا واحدًا على الأقل."}),offersCompensation:o.z.boolean().default(!1),compensationDetails:o.z.array(R).optional()}),_=["instituteur_secondaire","prof_1er_cycle","prof_2eme_cycle"];function I(){let[e,s]=(0,d.useState)(!1),{toast:l}=(0,N.dj)(),r=(0,j.useRouter)(),t=(0,j.useSearchParams)(),[o,R]=(0,d.useState)(null),I=(0,c.mN)({resolver:(0,i.u)(S),defaultValues:{username:t.get("username")||"",phone:"",password:t.get("password")||"",desiredLocation:[],offersCompensation:!1,compensationDetails:[]}}),{fields:A,append:B,remove:L}=(0,c.jz)({control:I.control,name:"compensationDetails"});(0,d.useEffect)(()=>{!async function(){try{let e=await a.e(950).then(a.bind(a,1950));R({wilayas:e.WILAYAS,teacherFunctions:e.TEACHER_FUNCTIONS,instituteurSpecializations:e.INSTITUTEUR_SPECIALIZATIONS,profSpecializations:e.PROF_SPECIALIZATIONS})}catch(e){console.error("Failed to load constants",e),l({variant:"destructive",title:"Error",description:"Could not load required data."})}}()},[l]);let k=I.watch("teacherFunction"),F=k&&_.includes(k),J=I.watch("offersCompensation"),M=I.watch("desiredLocation"),D=I.watch("compensationDetails"),E=()=>o?["instituteur","instituteur_principal"].includes(k)?o.instituteurSpecializations:F?o.profSpecializations:[]:[],V=()=>{if(!o)return[];let e=M.map(e=>{if(e.startsWith("wilaya_")){let s=e.replace("wilaya_","");return{value:e,label:"".concat(s," (ولاية)")}}let s=o.wilayas.flatMap(e=>e.cities).find(s=>s.value===e);return{value:e,label:(null==s?void 0:s.label)||e}}),s=new Set(null==D?void 0:D.map(e=>e.location));return e.filter(e=>!s.has(e.value))};async function q(e){var a;s(!0);let n="".concat(e.username.toLowerCase(),"@tabadol.mr"),t=(null==(a=e.compensationDetails)?void 0:a.reduce((e,s)=>(s.location&&s.amount>=0&&(e[s.location]=s.amount),e),{}))||{};try{let s=(await (0,p.eJ)(f.j,n,e.password)).user;await (0,v.BN)((0,v.H9)(f.db,"users",s.uid),{username:e.username,phone:e.phone,teacherFunction:e.teacherFunction,specialization:e.specialization,currentLocation:e.currentLocation,desiredLocation:e.desiredLocation,offersCompensation:e.offersCompensation,compensationDetails:t,email:n,createdAt:v.Dc.now(),lastUpdated:v.Dc.now(),role:"user"}),l({title:"تم إنشاء الحساب بنجاح",description:"يمكنك الآن تسجيل الدخول."}),r.push("/login")}catch(s){console.error("Registration error:",s);let e="حدث خطأ غير متوقع. يرجى المحاولة مرة أخرى.";"auth/email-already-in-use"===s.code?e="اسم المستخدم هذا مستخدم بالفعل.":"auth/weak-password"===s.code&&(e="كلمة المرور ضعيفة جدًا."),l({variant:"destructive",title:"خطأ في إنشاء الحساب",description:e})}finally{s(!1)}}return o?(0,n.jsx)(y.lV,{...I,children:(0,n.jsxs)("form",{onSubmit:I.handleSubmit(q),className:"space-y-6",children:[(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsx)(y.zB,{control:I.control,name:"username",render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"اسم المستخدم"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(b.p,{placeholder:"مثال: ahmedsalem",...s})}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(y.zB,{control:I.control,name:"password",render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"كلمة المرور"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(b.p,{type:"password",placeholder:"********",...s})}),(0,n.jsx)(y.Rr,{children:"8 أحرف على الأقل. يُنصح باستخدام كلمة مرور مختلفة عن تلك الخاصة بمنصة الوزارة الرسمية."}),(0,n.jsx)(y.C5,{})]})}})]}),(0,n.jsx)(y.zB,{control:I.control,name:"phone",render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"رقم الهاتف"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(b.p,{placeholder:"مثال: 47470407",...s})}),(0,n.jsx)(y.Rr,{children:"للتواصل عبر الواتساب."}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,n.jsx)(y.zB,{control:I.control,name:"teacherFunction",render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"الوظيفة"}),(0,n.jsxs)(C.l6,{onValueChange:e=>{s.onChange(e),I.resetField("specialization")},defaultValue:s.value,children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(C.bq,{children:(0,n.jsx)(C.yv,{placeholder:"اختر وظيفتك"})})}),(0,n.jsx)(C.gC,{children:o.teacherFunctions.map(e=>(0,n.jsx)(C.eb,{value:e.value,children:e.label},e.value))})]}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(y.zB,{control:I.control,name:"specialization",render:()=>(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"التخصص"}),k?F?(0,n.jsx)("div",{className:"space-y-2 p-2 border rounded-md",children:E().map(e=>(0,n.jsx)(y.zB,{control:I.control,name:"specialization",render:s=>{let{field:a}=s,r=Array.isArray(a.value)?a.value:[];return(0,n.jsxs)(y.eI,{className:"flex flex-row items-start space-x-3 space-x-reverse space-y-0",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(z.S,{checked:r.includes(e.value),onCheckedChange:s=>{let n=[...r];s?n.length<2?n.push(e.value):l({variant:"destructive",title:"لا يمكن تحديد أكثر من تخصصين."}):n=n.filter(s=>s!==e.value),a.onChange(n)}})}),(0,n.jsx)(y.lR,{className:"font-normal",children:e.label})]},e.value)}},e.value))}):(0,n.jsx)(y.zB,{control:I.control,name:"specialization",render:e=>{let{field:s}=e;return(0,n.jsxs)(C.l6,{onValueChange:e=>s.onChange(e),value:"string"==typeof s.value?s.value:"",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(C.bq,{children:(0,n.jsx)(C.yv,{placeholder:"اختر تخصصك"})})}),(0,n.jsx)(C.gC,{children:E().map(e=>(0,n.jsx)(C.eb,{value:e.value,children:e.label},e.value))})]})}}):(0,n.jsx)(C.l6,{disabled:!0,children:(0,n.jsx)(C.bq,{children:(0,n.jsx)(C.yv,{placeholder:"اختر وظيفة أولاً"})})}),(0,n.jsx)(y.C5,{})]})})]}),(0,n.jsx)(y.zB,{control:I.control,name:"currentLocation",render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"الموقع الحالي"}),(0,n.jsxs)(C.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(C.bq,{children:(0,n.jsx)(C.yv,{placeholder:"اختر موقع عملك الحالي"})})}),(0,n.jsx)(C.gC,{children:o.wilayas.map(e=>(0,n.jsxs)(C.s3,{children:[(0,n.jsx)(y.lR,{className:"px-2 py-1.5 text-xs font-semibold",children:e.name}),e.cities.map(e=>(0,n.jsx)(C.eb,{value:e.value,children:e.label},e.value))]},e.name))})]}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(y.zB,{control:I.control,name:"desiredLocation",render:()=>(0,n.jsxs)(y.eI,{children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(y.lR,{className:"text-base",children:"الأماكن المرغوبة"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"اختر المدن أو الولايات التي ترغب في الانتقال إليها."})]}),(0,n.jsx)("div",{className:"space-y-4",children:o.wilayas.map(e=>(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(y.zB,{control:I.control,name:"desiredLocation",render:s=>{var a;let{field:l}=s,r=e.cities.every(e=>{var s;return null==(s=l.value)?void 0:s.includes(e.value)}),t="wilaya_".concat(e.name),i=(null==(a=l.value)?void 0:a.includes(t))||r;return(0,n.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse rounded-md border p-2 bg-muted/50",children:[(0,n.jsx)(z.S,{id:t,checked:i,onCheckedChange:s=>{let a=e.cities.map(e=>e.value),n=l.value?[...l.value]:[];if(s)n=[...new Set([...n,...a,t])];else{let e=new Set(a);n=n.filter(s=>!e.has(s)&&s!==t)}l.onChange(n)}}),(0,n.jsxs)("label",{htmlFor:t,className:"font-semibold text-sm",children:[e.name," (تحديد الكل)"]})]})}}),(0,n.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-2 pr-4",children:e.cities.map(s=>(0,n.jsx)(y.zB,{control:I.control,name:"desiredLocation",render:a=>{var l;let{field:r}=a;return(0,n.jsxs)(y.eI,{className:"flex flex-row items-start space-x-3 space-x-reverse space-y-0",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(z.S,{checked:null==(l=r.value)?void 0:l.includes(s.value),onCheckedChange:a=>{let n=a?[...r.value||[],s.value]:(r.value||[]).filter(e=>e!==s.value),l=e.cities.every(e=>n.includes(e.value)),t="wilaya_".concat(e.name);l&&!n.includes(t)?n.push(t):!l&&n.includes(t)&&n.splice(n.indexOf(t),1),r.onChange(n)}})}),(0,n.jsx)(y.lR,{className:"font-normal",children:s.label})]},s.value)}},s.value))})]},e.name))}),(0,n.jsx)(y.C5,{})]})}),(0,n.jsx)(y.zB,{control:I.control,name:"offersCompensation",render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,n.jsxs)("div",{className:"space-y-0.5",children:[(0,n.jsxs)(y.lR,{className:"text-base flex items-center gap-2",children:[(0,n.jsx)(x.A,{}),"عرض مقابل مادي"]}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"هل أنت على استعداد لتقديم تعويض مالي للتبديل؟"})]}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(w.d,{checked:s.value,onCheckedChange:s.onChange})})]})}}),J&&(0,n.jsxs)("div",{className:"space-y-4 rounded-lg border p-4",children:[(0,n.jsx)(y.lR,{className:"text-base",children:"تحديد مبالغ المقابل المادي"}),(0,n.jsx)(y.Rr,{children:"حدد مبلغًا لكل مدينة أو ولاية ترغب في تقديم مقابل لها. يمكنك ترك الحقل فارغًا لعدم تحديد مقابل لمكان معين."}),(0,n.jsx)("div",{className:"space-y-2",children:A.map((e,s)=>(0,n.jsxs)("div",{className:"grid grid-cols-[1fr_auto_auto] items-end gap-2",children:[(0,n.jsx)(y.zB,{control:I.control,name:"compensationDetails.".concat(s,".location"),render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"الموقع"}),(0,n.jsxs)(C.l6,{onValueChange:s.onChange,defaultValue:s.value,children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(C.bq,{children:(0,n.jsx)(C.yv,{placeholder:"اختر موقعًا..."})})}),(0,n.jsx)(C.gC,{children:V().map(e=>(0,n.jsx)(C.eb,{value:e.value,children:e.label},e.value))})]}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(y.zB,{control:I.control,name:"compensationDetails.".concat(s,".amount"),render:e=>{let{field:s}=e;return(0,n.jsxs)(y.eI,{children:[(0,n.jsx)(y.lR,{children:"المبلغ"}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(b.p,{type:"number",placeholder:"0",...s})}),(0,n.jsx)(y.C5,{})]})}}),(0,n.jsx)(g.$,{type:"button",variant:"destructive",size:"icon",onClick:()=>L(s),children:(0,n.jsx)(h.A,{className:"h-4 w-4"})})]},e.id))}),(0,n.jsxs)(g.$,{type:"button",variant:"outline",size:"sm",className:"mt-2",onClick:()=>B({location:"",amount:0}),disabled:0===V().length,children:[(0,n.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"إضافة مقابل لموقع آخر"]}),0===V().length&&(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"لقد قمت بتحديد مقابل لكل المواقع المرغوبة."})]}),(0,n.jsxs)(g.$,{type:"submit",className:"w-full",disabled:e,children:[e&&(0,n.jsx)(u.A,{className:"ml-2 h-4 w-4 animate-spin"}),"إنشاء الحساب"]})]})}):(0,n.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,n.jsx)(u.A,{className:"h-8 w-8 animate-spin"})})}function A(){return(0,n.jsxs)(t.Zp,{className:"w-full max-w-2xl mx-auto my-8",children:[(0,n.jsxs)(t.aR,{className:"text-center",children:[(0,n.jsx)(t.ZB,{className:"text-2xl font-headline",children:"إنشاء حساب جديد"}),(0,n.jsx)(t.BT,{children:"املأ النموذج أدناه للانضمام إلى منصتنا والعثور على فرصة التبادل المثالية"})]}),(0,n.jsxs)(t.Wu,{children:[(0,n.jsx)(I,{}),(0,n.jsxs)("div",{className:"mt-4 text-center text-sm",children:["لديك حساب بالفعل؟"," ",(0,n.jsx)(r(),{href:"/login",className:"underline text-primary",children:"تسجيل الدخول"})]})]})]})}function B(){return(0,n.jsx)(d.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading..."}),children:(0,n.jsx)(A,{})})}},4563:(e,s,a)=>{Promise.resolve().then(a.bind(a,3075))}},e=>{var s=s=>e(e.s=s);e.O(0,[992,644,769,611,417,874,670,788,521,441,684,358],()=>s(4563)),_N_E=e.O()}]);